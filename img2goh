#!/bin/bash

# set some variables
appIconF=$1
toolF=$2

outf="${appIconF%.*}".pcx
gohf="${appIconF%.*}".goh

toolPcxF="${toolF%.*}".pcx
toolGohF="${toolF%.*}".goh

# convert any modern image to old-school pcx
# the script "returns" the color index of the magenta background color
# that we want to mask out for transparency using the "m" option in
# cvtpcx
identify $appIconF
colormapIdx=$(img2pcx $appIconF | tail -n1)
identify $outf

# make sure we have the correct dimensions
width=`identify -format '%w' $outf`
height=`identify -format '%h' $outf`

# call the CVTPCX methusalem
#cvtpcx -G -2 -m"$colormapIdx" -w"$width" -h"$height" -Sicon -sstandard -anormal -o"$gohf" $outf
cvtpcx -G -2 -m"$colormapIdx" -Sicon -o"$gohf" $outf

# delete PCX image
rm $outf

# Tool icon
#
# make sure we have the correct dimensions
# convert $outf -gravity center -crop "$width"x"$height"+0+0 +repage $outf

identify $toolF
colormapIdx=$(img2pcx $toolF | tail -n1)
identify $toolPcxF

# call the CVTPCX methusalem
cvtpcx -G -2 -m"$colormapIdx" -Stool -w15 -h15 -o"$toolGohF" $toolPcxF

# delete PCX image, not needed anymore
rm $toolPcxF